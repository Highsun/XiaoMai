# 前后端联调启动指南

本指南适用于指导在本地启动并测试本项目的登录注册功能前后端联合调试。

---

## 一、前提条件

* **Git**
* **Node.js & npm**
* **Python 3.9+**
* **（可选）Conda 或 Virtualenv**
* **SQLite3**（查看本地数据库用）

---

## 二、获取代码

```bash
git clone https://github.com/Maxence-29/XiaoMai.git
cd XiaoMai
```

---

## 三、后端（Flask）设置

### 1. 进入后端目录

```bash
cd backend
```

### 2. 创建／激活虚拟环境

* **Windows PowerShell**（Conda base 或 virtualenv 均可）

  ```powershell
  # 如果用 Conda base 环境，可跳过
  conda activate base

  # 若用 virtualenv：
  python -m venv .venv
  .\.venv\Scripts\Activate
  ```

* **macOS/Linux**

  ```bash
  python3 -m venv .venv
  source .venv/bin/activate
  ```

### 3. 安装依赖

```bash
pip install -r requirements.txt
```

### 4. 配置环境变量

* **Windows PowerShell**

  ```powershell
  $env:FLASK_APP   = "backend.app:create_app"
  $env:FLASK_ENV   = "development"
  ```

* **macOS/Linux**

  ```bash
  export FLASK_APP="backend.app:create_app"
  export FLASK_ENV="development"
  ```

### 5. （首次）初始化并执行数据库迁移

```bash
flask db init         # 仅第一次
flask db migrate -m "init users"
flask db upgrade
```

### 6. 启动后端

```bash
flask run
```

* 默认：`http://127.0.0.1:5000`

---

## 四、前端（Vite + Vue）设置

回到项目根目录：

```bash
cd ..
```

### 1. 安装依赖

```bash
npm install
```


### 2. 启动前端

```bash
npm run dev
```

* 默认：`http://localhost:3000`

---

## 五、前后端联调 & 测试

1. 浏览器打开 `http://localhost:3000`

2. **注册流程**

   * 访问 `/register` 页面
   * 填写 用户名 / 邮箱 / 密码 / 确认密码 → 点击 “注册”
   * Network 面板应出现 `POST /api/auth/register` → 返回 `{ msg: '注册成功' }`

3. **登录流程**

   * 访问 `/login` 页面
   * 填写 用户名或邮箱 / 密码 → 点击 “登录”
   * Network 面板应出现 `POST /api/auth/login` → 返回 `{ access_token: '…' }`
   * Token 会自动存入 `localStorage`

---

## 六、查看已注册用户（SQLite）

后端使用 `SQLite` 存储，数据库文件位于 `backend/app.db`。

### 1. 命令行查看

```bash
cd backend
sqlite3 app.db
.tables
SELECT id, username, email, password_hash, created_at FROM users;
.exit
```

### 2. 可视化工具

* 下载并安装 **DB Browser for SQLite**
* 打开 `backend/app.db` → “Browse Data” → 选中 `users` 表，即可查看记录。

---

## 七、热重载 & 代码更改

* **后端**：已开启 `debug=True`，保存 `.py` 文件后会自动重启
* **前端**：Vite 热更新（HMR），保存 `.vue` / `.js` 文件后自动刷新

---

## 八、常见问题

* **400 “请输入用户名/邮箱和密码”**：

  1. 检查 Network → Request Payload 是否包含 `{ account, password }`
  2. 确保前端调用了

     ```js
     login({ account: account.value, password: password.value })
     ```
* **跨域或 404**：

  1. 确认后端正在 `5000` 端口运行
  2. 确认 Vite 代理配置正确
* **数据库迁移失败**：

  * 删除 `backend/migrations/` 后重新 `flask db init`

